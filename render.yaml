services:
  # Backend API (.NET) via native build (free tier)
  - type: web
    name: inovasaude-backend-2
    runtime: dotnet
    plan: free
    rootDir: backend
    buildCommand: "dotnet restore && dotnet publish src/InovaSaude.API/InovaSaude.API.csproj -c Release -o out"
    startCommand: "dotnet out/InovaSaude.API.dll"
    envVars:
      - key: ASPNETCORE_ENVIRONMENT
        value: Production
      - key: PORT
        value: "5000"
      - key: ConnectionStrings__DefaultConnection
        fromDatabase:
          name: inovasaude-db
          property: connectionString
      - key: Jwt__SecretKey
        generateValue: true
      - key: Jwt__Issuer
        value: InovaSaude
      - key: Jwt__Audience
        value: InovaSaude
      - key: Jwt__ExpirationMinutes
        value: "60"
      - key: Cors__AllowedOrigins
        value: "https://inovasaude-frontend-static.onrender.com"
    healthCheckPath: /health

  # Frontend Static Site (Render spec: type web + runtime static)
  - type: web
    name: inovasaude-frontend-static
    runtime: static
    rootDir: frontend
    buildCommand: "npm install && npm run build"
    staticPublishPath: dist
    envVars:
      - key: VITE_API_URL
        value: "https://inovasaude-backend-2.onrender.com/api"

databases:
  - name: inovasaude-db
    plan: free
    postgresMajorVersion: "18"
