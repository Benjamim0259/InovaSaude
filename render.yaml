services:
  # PostgreSQL Database
  - type: pserv
    name: inovasaude-db
    env: postgres
    plan: free
    postgresMajorVersion: 18

  # Backend API (.NET) via Docker
  - type: web
    name: inovasaude-backend
    runtime: docker
    plan: free
    dockerfilePath: backend/Dockerfile
    autoDeploy: true
    envVars:
      - key: ASPNETCORE_ENVIRONMENT
        value: Production
      - key: PORT
        value: "5000"
      - key: ConnectionStrings__DefaultConnection
        fromDatabase:
          name: inovasaude-db
          property: connectionString
      - key: Jwt__SecretKey
        generateValue: true
      - key: Jwt__Issuer
        value: InovaSaude
      - key: Jwt__Audience
        value: InovaSaude
      - key: Jwt__ExpirationMinutes
        value: "60"
      - key: Cors__AllowedOrigins
        value: "https://inovasaude-frontend.onrender.com"
    healthCheckPath: /health

  # Frontend Static Site (Render spec: type web + runtime static)
  - type: web
    name: inovasaude-frontend
    runtime: static
    plan: free
    rootDir: frontend
    buildCommand: "npm install && npm run build"
    staticPublishPath: dist
    envVars:
      - key: VITE_API_URL
        value: "https://inovasaude-backend.onrender.com/api"

databases:
  - name: inovasaude-db
    plan: free
    postgresMajorVersion: "18"
