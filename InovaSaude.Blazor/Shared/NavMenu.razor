<div class="top-row ps-3 navbar navbar-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="">🏥 InovaSaúde</a>
        <button title="Navigation menu" class="navbar-toggler" @onclick="ToggleNavMenu">
          <span class="navbar-toggler-icon"></span>
        </button>
    </div>
</div>

<div class="@NavMenuCssClass nav-scrollable" @onclick="ToggleNavMenu">
    <nav class="flex-column">
   <!-- Opções públicas (sempre visíveis) -->
        <div class="nav-item px-3">
   <NavLink class="nav-link" href="" Match="NavLinkMatch.All">
            <span class="oi oi-home" aria-hidden="true"></span> Home
    </NavLink>
    </div>

        <AuthorizeView>
            <Authorized>
  <!-- Menu administrativo (apenas para usuários autenticados) -->
 <hr class="my-2" />
          <div class="px-3 mb-2">
        <small class="text-muted">ÁREA ADMINISTRATIVA</small>
     </div>

          <div class="nav-item px-3">
       <NavLink class="nav-link" href="dashboard">
            <span class="oi oi-dashboard" aria-hidden="true"></span> Dashboard
      </NavLink>
    </div>

  <div class="nav-item px-3">
        <NavLink class="nav-link" href="gerenciar-usuarios">
      <span class="oi oi-people" aria-hidden="true"></span> Usuários
    </NavLink>
        </div>

            <div class="nav-item px-3">
           <NavLink class="nav-link" href="gerenciar-despesas">
           <span class="oi oi-dollar" aria-hidden="true"></span> Despesas
     </NavLink>
  </div>

     <div class="nav-item px-3">
   <NavLink class="nav-link" href="gerenciar-ubs">
           <span class="oi oi-medical-cross" aria-hidden="true"></span> UBS
        </NavLink>
                </div>

     <div class="nav-item px-3">
            <NavLink class="nav-link" href="gerar-relatorios">
   <span class="oi oi-bar-chart" aria-hidden="true"></span> Relatórios
        </NavLink>
      </div>

           <div class="nav-item px-3">
      <NavLink class="nav-link" href="workflows">
              <span class="oi oi-fork" aria-hidden="true"></span> Workflows
                  </NavLink>
</div>

         <div class="nav-item px-3">
          <NavLink class="nav-link" href="integracoes">
   <span class="oi oi-cloud-upload" aria-hidden="true"></span> Integrações
          </NavLink>
                </div>

       <hr class="my-2" />
       <div class="px-3 mb-2">
  <small class="text-muted">FARMÁCIA CENTRAL</small>
      </div>

         <div class="nav-item px-3">
      <NavLink class="nav-link" href="pedidos-medicamentos">
        <span class="oi oi-clipboard" aria-hidden="true"></span> Meus Pedidos
      </NavLink>
             </div>

       <AuthorizeView Roles="ADMIN,FARMACEUTICO">
    <Authorized Context="farmaciaContext">
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="aprovar-pedidos">
   <span class="oi oi-check" aria-hidden="true"></span> Aprovar Pedidos
       </NavLink>
  </div>

          <div class="nav-item px-3">
       <NavLink class="nav-link" href="gerenciar-estoque">
             <span class="oi oi-box" aria-hidden="true"></span> Gerenciar Estoque
        </NavLink>
  </div>
       </Authorized>
      </AuthorizeView>

 <div class="nav-item px-3">
      <NavLink class="nav-link" href="integracoes-externas">
      <span class="oi oi-globe" aria-hidden="true"></span> APIs Externas
          </NavLink>
        </div>

        <hr class="my-2" />

         <div class="nav-item px-3">
 <a class="nav-link text-danger" href="#" @onclick="Logout" @onclick:preventDefault>
       <span class="oi oi-account-logout" aria-hidden="true"></span> Sair
 </a>
     </div>
            </Authorized>
        <NotAuthorized>
 <!-- Opções para visitantes não autenticados -->
    <hr class="my-2" />

           <div class="nav-item px-3">
                 <NavLink class="nav-link" href="sobre">
    <span class="oi oi-info" aria-hidden="true"></span> Sobre
    </NavLink>
    </div>

<div class="nav-item px-3">
          <NavLink class="nav-link" href="contato">
           <span class="oi oi-envelope-closed" aria-hidden="true"></span> Contato
 </NavLink>
         </div>

        <hr class="my-2" />

        <div class="nav-item px-3">
              <NavLink class="nav-link btn-primary text-white" href="login">
      <span class="oi oi-account-login" aria-hidden="true"></span> Entrar
     </NavLink>
      </div>
   </NotAuthorized>
        </AuthorizeView>
    </nav>
</div>

@inject HttpClient Http
@inject NavigationManager Navigation

@code {
    private bool collapseNavMenu = true;

    private string? NavMenuCssClass => collapseNavMenu ? "collapse" : null;

 private void ToggleNavMenu()
    {
        collapseNavMenu = !collapseNavMenu;
    }

    private async Task Logout()
    {
        try
        {
        await Http.PostAsync("/account/logout", null);
      // reload to clear auth
            Navigation.NavigateTo("/", true);
        }
        catch
        {
            Navigation.NavigateTo("/", true);
  }
    }
}
